const RegionesYcomunas = [
	{
		"NombreRegion": "Arica y Parinacota",
		"comunas": ["Arica", "Camarones", "Putre", "General Lagos"]
	},
	{
		"NombreRegion": "Tarapacá",
		"comunas": ["Iquique", "Alto Hospicio", "Pozo Almonte", "Camiña", "Colchane", "Huara", "Pica"]
	},
	{
		"NombreRegion": "Antofagasta",
		"comunas": ["Antofagasta", "Mejillones", "Sierra Gorda", "Taltal", "Calama", "Ollagüe", "San Pedro de Atacama", "Tocopilla", "María Elena"]
	},
	{
		"NombreRegion": "Atacama",
		"comunas": ["Copiapó", "Caldera", "Tierra Amarilla", "Chañaral", "Diego de Almagro", "Vallenar", "Alto del Carmen", "Freirina", "Huasco"]
	},
	{
		"NombreRegion": "Coquimbo",
		"comunas": ["La Serena", "Coquimbo", "Andacollo", "La Higuera", "Paiguano", "Vicuña", "Illapel", "Canela", "Los Vilos", "Salamanca", "Ovalle", "Combarbalá", "Monte Patria", "Punitaqui", "Río Hurtado"]
	},
	{
		"NombreRegion": "Valparaíso",
		"comunas": ["Valparaíso", "Casablanca", "Concón", "Juan Fernández", "Puchuncaví", "Quintero", "Viña del Mar", "Isla de Pascua", "Los Andes", "Calle Larga", "Rinconada", "San Esteban", "La Ligua", "Cabildo", "Papudo", "Petorca", "Zapallar", "Quillota", "Calera", "Hijuelas", "La Cruz", "Nogales", "San Antonio", "Algarrobo", "Cartagena", "El Quisco", "El Tabo", "Santo Domingo", "San Felipe", "Catemu", "Llaillay", "Panquehue", "Putaendo", "Santa María", "Quilpué", "Limache", "Olmué", "Villa Alemana"]
	},
	{
		"NombreRegion": "Región del Libertador Gral. Bernardo O’Higgins",
		"comunas": ["Rancagua", "Codegua", "Coinco", "Coltauco", "Doñihue", "Graneros", "Las Cabras", "Machalí", "Malloa", "Mostazal", "Olivar", "Peumo", "Pichidegua", "Quinta de Tilcoco", "Rengo", "Requínoa", "San Vicente", "Pichilemu", "La Estrella", "Litueche", "Marchihue", "Navidad", "Paredones", "San Fernando", "Chépica", "Chimbarongo", "Lolol", "Nancagua", "Palmilla", "Peralillo", "Placilla", "Pumanque", "Santa Cruz"]
	},
	{
		"NombreRegion": "Región del Maule",
		"comunas": ["Talca", "Constitución", "Curepto", "Empedrado", "Maule", "Pelarco", "Pencahue", "Río Claro", "San Clemente", "San Rafael", "Cauquenes", "Chanco", "Pelluhue", "Curicó", "Hualañé", "Licantén", "Molina", "Rauco", "Romeral", "Sagrada Familia", "Teno", "Vichuquén", "Linares", "Colbún", "Longaví", "Parral", "Retiro", "San Javier", "Villa Alegre", "Yerbas Buenas"]
	},
	{
		"NombreRegion": "Región de Ñuble",
		"comunas": ["Cobquecura", "Coelemu", "Ninhue", "Portezuelo", "Quirihue", "Ránquil", "Treguaco", "Bulnes", "Chillán Viejo", "Chillán", "El Carmen", "Pemuco", "Pinto", "Quillón", "San Ignacio", "Yungay", "Coihueco", "Ñiquén", "San Carlos", "San Fabián", "San Nicolás"]
	},
	{
		"NombreRegion": "Región del Biobío",
		"comunas": ["Concepción", "Coronel", "Chiguayante", "Florida", "Hualqui", "Lota", "Penco", "San Pedro de la Paz", "Santa Juana", "Talcahuano", "Tomé", "Hualpén", "Lebu", "Arauco", "Cañete", "Contulmo", "Curanilahue", "Los Álamos", "Tirúa", "Los Ángeles", "Antuco", "Cabrero", "Laja", "Mulchén", "Nacimiento", "Negrete", "Quilaco", "Quilleco", "San Rosendo", "Santa Bárbara", "Tucapel", "Yumbel", "Alto Biobío"]
	},
	{
		"NombreRegion": "Región de la Araucanía",
		"comunas": ["Temuco", "Carahue", "Cunco", "Curarrehue", "Freire", "Galvarino", "Gorbea", "Lautaro", "Loncoche", "Melipeuco", "Nueva Imperial", "Padre las Casas", "Perquenco", "Pitrufquén", "Pucón", "Saavedra", "Teodoro Schmidt", "Toltén", "Vilcún", "Villarrica", "Cholchol", "Angol", "Collipulli", "Curacautín", "Ercilla", "Lonquimay", "Los Sauces", "Lumaco", "Purén", "Renaico", "Traiguén", "Victoria"]
	},
	{
		"NombreRegion": "Región de Los Ríos",
		"comunas": ["Valdivia", "Corral", "Lanco", "Los Lagos", "Máfil", "Mariquina", "Paillaco", "Panguipulli", "La Unión", "Futrono", "Lago Ranco", "Río Bueno"]
	},
	{
		"NombreRegion": "Región de Los Lagos",
		"comunas": ["Puerto Montt", "Calbuco", "Cochamó", "Fresia", "Frutillar", "Los Muermos", "Llanquihue", "Maullín", "Puerto Varas", "Castro", "Ancud", "Chonchi", "Curaco de Vélez", "Dalcahue", "Puqueldón", "Queilén", "Quellón", "Quemchi", "Quinchao", "Osorno", "Puerto Octay", "Purranque", "Puyehue", "Río Negro", "San Juan de la Costa", "San Pablo", "Chaitén", "Futaleufú", "Hualaihué", "Palena"]
	},
	{
		"NombreRegion": "Región Aisén del Gral. Carlos Ibáñez del Campo",
		"comunas": ["Coihaique", "Lago Verde", "Aisén", "Cisnes", "Guaitecas", "Cochrane", "O’Higgins", "Tortel", "Chile Chico", "Río Ibáñez"]
	},
	{
		"NombreRegion": "Región de Magallanes y de la Antártica Chilena",
		"comunas": ["Punta Arenas", "Laguna Blanca", "Río Verde", "San Gregorio", "Cabo de Hornos (Ex Navarino)", "Antártica", "Porvenir", "Primavera", "Timaukel", "Natales", "Torres del Paine"]
	},
	{
		"NombreRegion": "Región Metropolitana de Santiago",
		"comunas": ["Cerrillos", "Cerro Navia", "Conchalí", "El Bosque", "Estación Central", "Huechuraba", "Independencia", "La Cisterna", "La Florida", "La Granja", "La Pintana", "La Reina", "Las Condes", "Lo Barnechea", "Lo Espejo", "Lo Prado", "Macul", "Maipú", "Ñuñoa", "Pedro Aguirre Cerda", "Peñalolén", "Providencia", "Pudahuel", "Quilicura", "Quinta Normal", "Recoleta", "Renca", "Santiago", "San Joaquín", "San Miguel", "San Ramón", "Vitacura", "Puente Alto", "Pirque", "San José de Maipo", "Colina", "Lampa", "Tiltil", "San Bernardo", "Buin", "Calera de Tango", "Paine", "Melipilla", "Alhué", "Curacaví", "María Pinto", "San Pedro", "Talagante", "El Monte", "Isla de Maipo", "Padre Hurtado", "Peñaflor"]
	 }
];
//Configuracion inicial
const reg = document.getElementById('regiones');
const comunas = document.getElementById('comunas');
const boxFech = document.getElementById('fecha-disponibilidad');
const fileInput = document.getElementById('fotos');
const emailInput = document.getElementById('email_donante');
const direction = document.getElementById('direction');
const fechaInput = document.getElementById('fecha');
const number_phone = document.getElementById("number-phone");
const idCantida = document.getElementById('cantidad');
const tipeDonation = document.getElementById('tipe-donation');
const nameDonate = document.getElementById('name_donante');
const ventanaEmergente = document.getElementById('ventana-emergente');
const description = document.getElementById('descripcion')
const condicionDeRetiro = document.getElementById('condiciones')


let predReg = '<option value="0">Seleccione región</option>';
let predCom = '<option value="0">Seleccione comuna</option>';

for(i = 0; i < RegionesYcomunas.length; i++){
	predReg = predReg + '<option value="'+ (i+1) + '">'+ RegionesYcomunas[i].NombreRegion + '</option>';
};

reg.innerHTML = predReg;
comunas.innerHTML = predCom;

//Cambio de las comunas segun la region
function createComunaSelect(){
	var val = document.getElementById('regiones').value;
	if (val != 0){	
		for(i = 0; i < RegionesYcomunas[(val-1)].comunas.length; i++){
			predCom = predCom + '<option value="'+ (i+1) + '">'+ RegionesYcomunas[(val-1)].comunas[i] + '</option>';
		};
	}
	comunas.innerHTML = predCom;
}

//Validacio Direccion 

function validationDirection(){
	if (direction.value == ''){
		direction.style.border = "2px solid red";
		alert("direccion no valida");
		return false;
	}
	if (direction.value.length > 80){
		alert('Se excedio el largo maximo de parametro')
		direction.style.border = "2px solid red";
		return false;
	} 
	direction.style.border = "2px solid rgba(0,0,0,0.2)";
	return true;
}
direction.addEventListener('change', () => {validationDirection});


//Validacion de carga de imagenes
function validationFiles(){

	const selectedFiles = fileInput.files;
	if (selectedFiles.length < 1) {
		alert('Debe seleccionar al menos 1 archivo');
		fileInput.style.border = "2px solid red";
		fileInput.value = '';
		return false;
	}
	if (selectedFiles.length > 3) {
		alert('Solo puede seleccionar hasta 3 archivos');
		fileInput.style.border = "2px solid red";
		fileInput.value = '';
		return false;
	}
	fileInput.style.border = "2px solid rgba(0,0,0,0.2)";
	return true;
}



function validaEmail(){
	const regexEmail = /^\w+([.-_+]?\w+)*@\w+([.-]?\w+)*(\.\w{2,10})+$/;
	const emailIngresado = emailInput.value

	if(!regexEmail.test(emailIngresado)){
		alert('Formato de email no valido');
		emailInput.value = '';
		emailIngresado.style.border = "2px solid red";
		return false;
	}
	if (emailIngresado.length > 80){
		alert('Email demasiado largo');
		emailIngresado.style.border = "2px solid red";
		return false;
	}
	emailInput.style.border = "2px solid rgba(0,0,0,0.2)";
	return true;
}

//Validacion fecha
function validaFecha(){
	const fechaIngresada = fechaInput.value;
	const regexFecha = /^(\d{4})-(\d{2})-(\d{2})$/;
	
	if (!regexFecha.test(fechaIngresada)) {
		alert('Formato de fecha no valido');
		fechaInput.value = '';
		fechaInput.style.border = "2px solid red";
		return false;
	}
	
	const [_, anio, mes, dia] = regexFecha.exec(fechaIngresada);
    const fechaSeleccionada = new Date(anio, mes-1, dia);
	const fecha = new Date();
    fechaActual = new Date(fecha.getFullYear(), fecha.getMonth() ,fecha.getDate());
    
    if (fechaSeleccionada.getFullYear() != anio || fechaSeleccionada.getMonth() + 1 != mes || fechaSeleccionada.getDate() != dia) {
		alert('La fecha ingresada no es válida');
		fechaInput.value = '';
		fechaInput.style.border = "2px solid red";
		return false;
	}
	else if (fechaSeleccionada < fechaActual){
		alert('La fecha ingresada debe ser mayor o igual a la fecha actual');
		fechaInput.value = '';
		fechaInput.style.border = "2px solid red";
		return false;
	}
	fechaInput.style.border = "2px solid rgba(0,0,0,0.2)";
	return true;
};



function validateNumberPhone(){
	const regexTelefono = /^\+569\d+$/;
	const numeroTelefono = number_phone.value;
	if (numeroTelefono == ''){
		number_phone.style.border = "2px solid rgba(0,0,0,0.2)";
		return true;
	}
	if (!regexTelefono.test(numeroTelefono)) {
		number_phone.value = '';
		alert('El número de teléfono ingresado no es válido');
		number_phone.style.border = "2px solid red";
		return false;
	}
	if (numeroTelefono.length > 15){
		alert('El número de teléfono demasiado largo');
		number_phone.style.border = "2px solid red";
		return false;
	}
	console.log('El número de teléfono ingresado es válido');
	number_phone.style.border = "2px solid rgba(0,0,0,0.2)";
	return true;
}

//Validacion de la cantidad
function validateCantidad(){
	const isNumber = /^(?=.*\d)+(?=.*[a-zA-Z])[0-9a-zA-Z]+$/;
	if (!isNumber.test(idCantida.value)){
		alert("inserte cantidad valida (por ejemplo 10L)");
		idCantida.value = '';
		idCantida.style.border = "2px solid red";
		return false;
	}
	const numberCant = parseInt(idCantida.value);
	if (numberCant.length <= 0){
		alert('Inserte valor valido');
		idCantida.value = '';
		idCantida.style.border = "2px solid red";
		return false;
	}
	if (idCantida.length > 10){
		alert("se excedio largo maximo de paramatro");
		idCantida.value = '';
		idCantida.style.border = "2px solid red";
		return false
	}
	idCantida.style.border = "2px solid rgba(0,0,0,0.2)";
	return true;
}

ventanaEmergente.style.display = 'none';
//Funcion que se activa al presionar el boton
function validation(){
	let validate = true;
	if (reg.value == "0"){
		validate = false;
		reg.style.border = "2px solid red";
	}
	if (comunas.value == "0" ){
		validate = false;
		comunas.style.border = "2px solid red";
	}if (tipeDonation.value == "0"){
		validate = false;
		tipeDonation.style.border = "2px solid red";
	}
	if (!validateNumberPhone())validate = false;
	if (!validaEmail())validate = false;
	if (!validaFecha())validate = false;
	if (!validationDirection())validate = false;
	if (!validationFiles())validate = false;
	if (!validateCantidad())validate = false;

	if (nameDonate.value.length < 3){
		validate = false;
		if (nameDonate.value == ''){
			alert("Inserte el Nombre");
			nameDonate.style.border = "red";
		}
		else alert("Nombre demasiado corto");
		nameDonate.style.border = "2px solid red";
	}

	if (nameDonate.value.length > 80){
		validate = false;
		nameDonate.style.border = "2px solid red";
		alert("Nombre demasiado larga");
	}

	if (description.value > 80){
		validate = false;
		description.style.border = "2px solid red";
		alert("Descripción demasiado larga");
	}
	if (condicionDeRetiro.value.length > 80){
		validate = false;
		condicionDeRetiro.style.border = "2px solid red";
		alert("Condición demasiado larga");
	}

	//Validacion final
	if (validate == false){
		alert("Complete formulario");
	}
	else{
		ventanaEmergente.style.display = 'block';
	}
}


function aceptated(value){
	if (value == 1) window.location.href = '../html/inicio.html';
	else ventanaEmergente.style.display = 'None';
}